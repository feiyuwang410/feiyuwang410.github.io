<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>杭州公寓年化回报柱状图</title>
  <!-- 引入 ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
</head>

<body>
  <!-- 图表容器 -->
  <div id="main" style="width: 100%; height: 600px;"></div>

  <script>
    // 数据源 URL
    const dataUrl = 'https://raw.githubusercontent.com/feiyuwang410/feiyuwang410.github.io/refs/heads/main/%E6%9D%AD%E5%B7%9E%E5%85%AC%E5%AF%93%E7%A7%9F%E5%94%AE%E6%AF%94.csv';

    // 加载数据
    async function loadData() {
      try {
        const response = await fetch(dataUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const csvData = await response.text();
        processData(csvData);
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    // 处理 CSV 数据
    function processData(csvData) {
      const rows = csvData.split('\n').filter(row => row.trim()!== '');
      const headers = rows[0].split(',');
      const apartmentData = [];

      for (let i = 1; i < rows.length; i++) {
        const row = rows[i].split(',');
        if (row.length < headers.length) continue;

        const apartment = {
          name: row[0].trim(),
          annualReturn: parseFloat(row[5])
        };

        if (!isNaN(apartment.annualReturn)) {
          apartmentData.push(apartment);
        }
      }

      renderChart(apartmentData);
    }

    // 渲染图表
    function renderChart(data) {
      const chartDom = document.getElementById('main');
      const myChart = echarts.init(chartDom);

      const names = data.map(item => item.name);
      const returns = data.map(item => item.annualReturn);

      const option = {
        xAxis: {
          type: 'category',
          data: names
        },
        yAxis: {
          type: 'value',
          name: '年化回报率(%)'
        },
        series: [{
          data: returns,
          type: 'bar',
          itemStyle: {
            color: 'skyblue'
          }
        }]
      };

      myChart.setOption(option);
    }

    // 页面加载完成后加载数据
    window.onload = loadData;
  </script>
</body>

</html>
