<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的旅游足迹地图</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=8d11d17ba1b1142ae3c63e4797a62c9e"></script>
    <style>
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .map-container {
                height: 100vh;
            }
        }
    </style>
</head>
<body class="bg-gray-50 p-0 m-0">
    <div class="relative w-full h-screen">
        <div id="map-container" class="map-container"></div>
        <div class="absolute top-4 left-4 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-4 z-10">
            <h1 class="text-xl font-bold text-gray-800 mb-2">我的旅游足迹</h1>
            <div class="flex items-center mb-1">
                <span class="w-4 h-4 rounded-full bg-blue-500 mr-2"></span>
                <span class="text-sm text-gray-700">已访问</span>
            </div>
            <div class="flex items-center">
                <span class="w-4 h-4 rounded-full bg-gray-300/50 mr-2"></span>
                <span class="text-sm text-gray-700">未访问</span>
            </div>
        </div>
        <div id="error-message" class="hidden absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-20"></div>
    </div>

    <script>
        window.onload = function() {
            try {
                const map = new AMap.Map('map-container', {
                    zoom: 4,
                    center: [105.000, 38.000],
                    viewMode: '2D'
                });

                const visitedProvinces = [
                    { name: '江苏省', adcode: '320000' },
                    { name: '浙江省', adcode: '330000' },
                    { name: '上海市', adcode: '310000' },
                    { name: '广东省', adcode: '440000' },
                    { name: '广西壮族自治区', adcode: '450000' }
                ];

                AMap.plugin('AMap.DistrictLayer', function() {
                    // 使用单个图层，通过回调函数动态设置样式
                    const nationLayer = new AMap.DistrictLayer.Country({
                        zIndex: 10,
                        adcode: '100000',
                        depth: 1,
                        style: {
                            'nation-stroke': '#9CA3AF',
                            'coastline-stroke': '#9CA3AF',
                            'province-stroke': '#9CA3AF',
                            'fill': function(props) {
                                // 根据adcode判断是否已访问
                                const isVisited = visitedProvinces.some(p => p.adcode === props.adcode);
                                return {
                                    fillColor: isVisited ? '#3B82F6' : '#F0F2F5',
                                    fillOpacity: isVisited ? 0.9 : 0.3,
                                    strokeColor: isVisited ? '#1D4ED8' : '#9CA3AF',
                                    strokeWeight: isVisited ? 1.5 : 1
                                };
                            }
                        }
                    });
                    nationLayer.setMap(map);

                    // 交互效果
                    map.on('mousemove', function(e) {
                        map.plugin('AMap.DistrictSearch', function() {
                            const search = new AMap.DistrictSearch({ level: 'province' });
                            search.search(e.pixel, function(status, result) {
                                if (status === 'complete' && result.districtList) {
                                    const name = result.districtList[0].name;
                                    const isVisited = visitedProvinces.some(p => p.name === name);
                                    map.setDefaultCursor(isVisited ? 'pointer' : 'default');
                                }
                            });
                        });
                    });

                    map.on('click', function(e) {
                        map.plugin('AMap.DistrictSearch', function() {
                            const search = new AMap.DistrictSearch({ level: 'province' });
                            search.search(e.pixel, function(status, result) {
                                if (status === 'complete' && result.districtList) {
                                    const name = result.districtList[0].name;
                                    if (visitedProvinces.some(p => p.name === name)) {
                                        alert(`你已访问过 ${name}`);
                                    }
                                }
                            });
                        });
                    });
                });
            } catch (error) {
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = `地图加载失败: ${error.message}`;
                errorMessage.classList.remove('hidden');
                console.error(error);
            }
        };
    </script>
</body>
</html>
    
